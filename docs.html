<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Documentazione</title>
  <link rel="icon" type="image/x-icon" href="https://mattiacot.github.io/website/images/favicon.ico">
  <link href="css/index.css" rel="stylesheet">
  <style>
    /* Migliora la tabella dei file */
    table {
      width: 80%;
      margin: 30px auto 0 auto;
      border-collapse: collapse;
      background: #222;
      color: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 14px 18px;
      text-align: left;
    }
    th {
      background: #333;
      color: #ffb347;
      font-size: 1.1em;
      border-bottom: 2px solid #04aa6d;
    }
    tr:nth-child(even) {
      background: #282828;
    }
    tr:hover {
      background: #444;
    }
    a.download-link {
      color: #04aa6d;
      text-decoration: underline;
      font-weight: bold;
      transition: color 0.2s;
    }
    a.download-link:hover {
      color: #ff6200;
    }
    #currentPath {
      margin-top: 30px;
      color: #ffb347;
      font-size: 1.3em;
      letter-spacing: 1px;
    }
    .back-link {
      display: inline-block;
      margin: 10px 0 20px 0;
      color: #04aa6d;
      cursor: pointer;
      font-size: 1.1em;
      text-decoration: none;
      transition: color 0.2s;
    }
    .back-link:hover {
      color: #ff6200;
      text-decoration: underline;
    }
  </style>
</head>
<body style="text-align:center;">
  <!-- Overlay di blocco -->
  <div id="blocker" style="position:fixed;inset:0;background:#111;z-index:9999;color:white;display:flex;align-items:center;justify-content:center;font-size:2em;">Controllo accesso...</div>
  <div id="navbar-placeholder"></div>

  <h1 style="display:inline-block;">Documentazione segreta</h1>
  <!-- Bottone upload in alto a destra -->
  <div style="position: absolute; right: 10%; top: 90px;">
    <form id="uploadForm" enctype="multipart/form-data" method="post">
      <label for="fileInput" style="background:#04aa6d;color:white;padding:8px 18px;border-radius:5px;cursor:pointer;font-weight:bold;">
        Carica file
        <input type="file" id="fileInput" name="file" style="display:none;">
      </label>
      <button type="submit" style="display:none;">Upload</button>
    </form>
  </div>

  <p>Questa è la sezione privata dei Docs.</p>
  <h2 id="currentPath">[cartella radice]</h2>
  <a class="back-link" id="backButton" style="display: none;">⬅ Torna indietro</a>
    
  <table>
      <thead>
          <tr>
              <th>Nome</th>
              <th>Dimensione</th>
              <th>Ultima modifica</th>
          </tr>
      </thead>
      <tbody id="fileTable">
      </tbody>
  </table>

  <script>
    // Controllo accesso diretto: eseguito subito!
    (function() {
      const pwd = sessionStorage.getItem("docs_access");
      if (pwd !== "Mattia") {
        window.location.replace("index.html");
      } else {
        // Sblocca la pagina solo se autorizzato
        window.addEventListener('DOMContentLoaded', function() {
          document.getElementById('blocker').style.display = 'none';
        });
      }
    })();

    // Carica navbar
    fetch('navbar.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('navbar-placeholder').innerHTML = html;
      });

    // Carica script solo dopo il caricamento della pagina
    window.onload = function() {
      let script = document.createElement("script");
      script.src = "scripts/script-obfuscated.js";
      document.body.appendChild(script);
    };

    // Gestione upload (solo lato client, richiede backend per funzionare davvero)
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) return alert('Seleziona un file da caricare!');
      const file = fileInput.files[0];

      // Esempio di upload con fetch (richiede endpoint /upload lato server)
      const formData = new FormData();
      formData.append('file', file);

      fetch('/upload', {
        method: 'POST',
        body: formData
      })
      .then(res => {
        if (res.ok) {
          alert('File caricato con successo!');
          location.reload();
        } else {
          alert('Errore nel caricamento del file.');
        }
      })
      .catch(() => alert('Errore di rete durante l\'upload.'));
    });
  </script>
</body>
</html>
